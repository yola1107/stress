[mysqld]

# ----------------- 基础 -----------------
user=mysql
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
pid-file=/var/run/mysqld/mysqld.pid

default_authentication_plugin=mysql_native_password
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci

skip-name-resolve
host-cache-size=0

wait_timeout=28800
interactive_timeout=28800
connect_timeout=15
lock_wait_timeout=50

# ----------------- InnoDB -----------------
innodb_file_per_table = 1
innodb_buffer_pool_size = 24G
innodb_buffer_pool_instances = 16
innodb_log_file_size = 2G
innodb_log_buffer_size = 256M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT
innodb_doublewrite = OFF
innodb_autoinc_lock_mode = 2
innodb_io_capacity = 4000
innodb_io_capacity_max = 16000  # 调高为16k，利用更多的SSD I/O吞吐量
innodb_read_io_threads = 8
innodb_write_io_threads = 8
innodb_purge_threads = 4
innodb_page_cleaners = 4
innodb_thread_concurrency = 16   # 优化并发数，提高并发处理性能
innodb_lock_wait_timeout = 100
innodb_adaptive_hash_index = ON

# ----------------- 连接 & 缓存 -----------------
max_connections = 1000    # 根据并发情况，可以适当增大连接数
thread_cache_size = 512   # 增大线程缓存，提高并发时的连接效率
table_open_cache = 16384  # 增大缓存数，减少表的打开次数
table_definition_cache = 8192  # 同上，增大定义缓存
open_files_limit = 65535

tmp_table_size = 1G  # 增大临时表的大小，避免频繁的磁盘I/O
max_heap_table_size = 1G  # 同上，确保内存中处理更多临时表

sort_buffer_size = 8M  # 增大排序缓冲区，有助于处理复杂查询
read_buffer_size = 8M  # 增大读取缓冲区
read_rnd_buffer_size = 8M  # 增大随机读取缓冲区
join_buffer_size = 8M  # 增大连接缓冲区

max_allowed_packet = 64M
bulk_insert_buffer_size = 1G  # 增大批量插入的缓存

key_buffer_size = 64M  # MyISAM表使用较少，稍微增大即可

# ----------------- Binlog -----------------
log-bin=mysql-bin
binlog_format=MIXED
sync_binlog=0  # 禁用二进制日志的同步，提升写入性能（根据是否需要备份和复制调整）
binlog_expire_logs_seconds=60000
max_binlog_size=1G

# ----------------- 日志 -----------------
log_error=/var/log/mysql/error.log
slow_query_log=1  # 开启慢查询日志，监控低效查询
long_query_time=2  # 慢查询时间阈值为2秒
log_queries_not_using_indexes=1  # 记录未使用索引的查询

# ----------------- 安全 -----------------
sql_mode=STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION

# ----------------- 客户端 -----------------
[mysql]
default-character-set=utf8mb4

[client]
default-character-set=utf8mb4